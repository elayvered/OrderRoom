<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,viewport-fit=cover">
  <title>Order Room v1.6.4</title>
  <link rel="preload" href="./data/suppliers.json" as="fetch" crossorigin="anonymous">
  <link rel="manifest" href="./manifest.webmanifest">
  <link rel="stylesheet" href="./css/style.v1.6.4.css">
</head>
<body>
<header class="or-header">
  <img class="logo" src="./assets/logo.png" alt="Sushi Room">
  <div>
    <div class="h-xl">Order Room</div>
    <div class="small">אפליקציית הזמנות סחורה החכמה של סושי רום • <b id="ver">v1.6.4</b> • <span id="latestTag"></span></div>
  </div>
</header>
<main class="or-main">
  <section id="view-home" class="view active">
    <div class="card">
      <div class="h-lg">היום: <span id="home-date"></span></div>
      <div id="home-to-enter"></div>
    </div>
    <div class="card">
      <div class="h-lg">סחורה מגיעה היום</div>
      <div id="home-arrivals"></div>
    </div>
    <div class="card">
      <div class="h-lg">הזמנות אחרונות</div>
      <div id="home-recent"></div>
    </div>
  </section>

  <section id="view-orders" class="view">
    <div class="card">
      <div class="inline">
        <div class="h-lg">הזמנה – <span id="orders-supplier-name"></span></div>
        <button id="btn-change-supplier" class="ghost-link">החלף ספק</button>
      </div>
      <div class="row dual">
        <div>
          <div class="small">סניף</div>
          <div id="branch-toggle" class="segmented"></div>
        </div>
        <div>
          <div class="small">יום אספקה</div>
          <button id="btn-open-delivery" class="choose-pill">
            <span class="ico" style="background-image:url('./assets/icons/cal.svg')"></span>
            <span id="deliver-label">נטען…</span>
          </button>
        </div>
      </div>
    </div>

    <div class="search-wrap"><input id="item-search" placeholder="חיפוש פריט…"></div>
    <div id="items-list" class="items-list"></div>

    <div class="card">
      <div class="h-lg">שורת טקסט חופשי</div>
      <div class="row dual">
        <input id="free-name" class="btn" placeholder="שם פריט (טקסט חופשי)">
        <div class="qty"><input id="free-qty" type="number" inputmode="numeric" min="0" step="1" placeholder="0"></div>
      </div>
      <button id="free-add" class="btn">הוסף לשורה</button>
      <div class="small">השורות החופשיות יופיעו בהודעה תחת פירוט ההזמנה</div>
    </div>

    <div class="card">
      <div>הערות להזמנה</div>
      <textarea id="order-notes" style="width:100%;min-height:84px;font-size:16px" placeholder="שדות ריקים לא יופיעו בהודעה"></textarea>
    </div>
  </section>

  <section id="view-history" class="view">
    <div class="card">
      <div class="h-lg">היסטוריית הזמנות</div>
      <div class="row dual">
        <input id="hist-filter-supplier" class="btn" placeholder="סינון לפי ספק">
        <input id="hist-filter-item" class="btn" placeholder="סינון לפי פריט">
      </div>
      <div id="history-list"></div>
    </div>
  </section>

  <section id="view-settings" class="view">
    <div class="card settings-list">
      <div class="h-lg">ניהול ספקים</div>
      <div id="settings-supplier-list"></div>
    </div>
    <div class="card">
      <div class="h-lg">ייבוא/ייצוא קונפיגורציה</div>
      <div class="row"><button id="btn-export" class="btn">ייצוא JSON</button><input id="import-file" type="file" accept="application/json" class="btn"></div>
    </div>
  </section>
</main>

<!-- Fixed order action bar -->
<div class="order-footer">
  <div class="wrap">
    <div class="bar">
      <div class="inline" style="gap:10px;flex-wrap:wrap">
        <button id="btn-save" class="btn primary">שמור הזמנה</button>
        <button id="btn-send" class="btn success">שלח הזמנה</button>
        <span class="badge"><span class="ico" style="background-image:url('./assets/icons/wa.svg')"></span> וואטסאפ</span>
        <span class="badge"><span class="ico" style="background-image:url('./assets/icons/mail.svg')"></span> מייל</span>
        <span class="badge"><span class="ico" style="background-image:url('./assets/icons/copy.svg')"></span> העתק</span>
      </div>
      <div class="small">שדות ריקים לא יופיעו בהודעה</div>
    </div>
  </div>
</div>

<nav class="tabbar">
  <button class="tab active" data-view="home"><span class="ico" style="background-image:url('./assets/icons/home.svg')"></span><span>בית</span></button>
  <button class="tab" data-view="orders"><span class="ico" style="background-image:url('./assets/icons/orders.svg')"></span><span>הזמנות</span></button>
  <button class="tab" data-view="history"><span class="ico" style="background-image:url('./assets/icons/history.svg')"></span><span>היסטוריה</span></button>
  <button class="tab" data-view="settings"><span class="ico" style="background-image:url('./assets/icons/settings.svg')"></span><span>הגדרות</span></button>
</nav>

<!-- Modals -->
<div id="deliver-modal" class="modal-back">
  <div class="modal">
    <div class="h-lg">בחר יום אספקה</div>
    <div id="deliver-chips" class="segmented" style="margin-top:10px;flex-wrap:wrap"></div>
    <div style="display:flex;justify-content:flex-end;margin-top:12px"><button id="deliver-close" class="btn ghost">סגור</button></div>
  </div>
</div>

<div id="send-modal" class="modal-back">
  <div class="modal">
    <div class="h-lg">שליחת הזמנה</div>
    <div id="send-desc" class="small"></div>
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px">
      <button id="send-whatsapp" class="btn success" style="display:none"><span class="ico" style="background-image:url('./assets/icons/wa.svg')"></span> וואטסאפ</button>
      <button id="send-email" class="btn" style="display:none"><span class="ico" style="background-image:url('./assets/icons/mail.svg')"></span> מייל</button>
      <button id="send-copy" class="btn"><span class="ico" style="background-image:url('./assets/icons/copy.svg')"></span> העתקה</button>
      <button id="send-close" class="btn ghost">סגור</button>
    </div>
  </div>
</div>

<div id="supplier-modal" class="modal-back">
  <div class="modal">
    <div class="h-lg">בחר ספק</div>
    <div id="supplier-grid" class="supplier-grid"></div>
    <div style="display:flex;justify-content:flex-end;margin-top:10px"><button id="supplier-close" class="btn ghost">סגור</button></div>
  </div>
</div>

<!-- Settings modals -->
<div id="settings-supplier-modal" class="modal-back">
  <div class="modal">
    <div class="h-lg">עריכת ספק</div>
    <div id="settings-supplier-form"></div>
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
      <button id="btn-supplier-save" class="btn primary">שמור</button>
      <button id="btn-supplier-cancel" class="btn ghost">סגור</button>
    </div>
  </div>
</div>

<div id="items-editor-modal" class="modal-back">
  <div class="modal">
    <div class="h-lg">ניהול פריטים</div>
    <div id="items-editor-body" style="max-height:60vh;overflow:auto"></div>
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
      <button id="btn-items-save" class="btn primary">שמור</button>
      <button id="btn-items-cancel" class="btn ghost">סגור</button>
    </div>
  </div>
</div>

<script>window.APP_VER="1.6.4";</script>
<script src="./js/app.v1.6.4.js"></script>
<script>
  fetch('../latest.json?_=' + Date.now()).then(r=>r.json()).then(function(j){
    if(j.latest === "1.6.4"){ document.getElementById('latestTag').textContent = 'latest'; }
  });
  if('serviceWorker' in navigator){ navigator.serviceWorker.register('./sw.js').catch(function(){}); }
</script>
</body>
</html>
