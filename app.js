/* OrderRoom home app — vanilla JS with smooth UX */ (function(){ const $ = (s, p=document) => p.querySelector(s); const $$ = (s, p=document) => Array.from(p.querySelectorAll(s)); // State in localStorage const store = { get key(){ return 'ordr_store_v1'; }, all(){ try{return JSON.parse(localStorage.getItem(this.key)) || {suppliers:[], products:[]}}catch(e){return {suppliers:[], products:[]}} }, save(data){ localStorage.setItem(this.key, JSON.stringify(data)); }, addSupplier(s){ const db=this.all(); db.suppliers.push(s); this.save(db); }, addProduct(p){ const db=this.all(); db.products.push(p); this.save(db); }, clearSuppliers(){ const db=this.all(); db.suppliers=[]; this.save(db); }, clearProducts(){ const db=this.all(); db.products=[]; this.save(db); } }; const yearEl = $('#year'); if(yearEl) yearEl.textContent = new Date().getFullYear(); // Smooth scroll $$('.btn[data-scroll]').forEach(btn => { btn.addEventListener('click', () => { const sel = btn.getAttribute('data-scroll'); const el = $(sel); if(el) el.scrollIntoView({behavior:'smooth', block:'start'}); }); }); // CTAs const ctaStart = $('#cta-start'); const ctaHeader = $('#cta-header'); [ctaStart, ctaHeader].forEach(el => { if(el){ el.addEventListener('click', () => $('#add-supplier').click()); } }); // Quick demo $('#quick-add-demo')?.addEventListener('click', () => { const demoSuppliers = [ { id: id(), name:'דיפלומט', phone:'', items:['אורז סושי בוטאן','אטריות שעועית','מיונז היינץ SOM','טופו קשה כחול','דיספנסר אדום','דיספנסר ירוק דל מלח','קטשופ לחיצה היינץ','סקיפי גדול','צילי מתוק הלתי בוי','צילי חריף הלתי בוי','שיטאקי','מחית פלפל קוראני','סויה גדול 15.1','סויה מנות TA','סויה מנות ירוק TA','מחית כמהין קטן'] }, { id: id(), name:'מדג סי פרוט', phone:'', items:['צלופח','שרימפס וונמי','טוביקו ירוק','טוביקו שחור','איקורא','קאט פיש'] }, { id: id(), name:'קרים  צ׳יז', phone:'', items:['קרים צ׳יז','בלוק חמאה צהובה','פרמזן גוש'] } ]; const demoProducts = [ { id:id(), name:'אורז סושי בוטאן', supplier:'דיפלומט', unit:'שק', sku:'BTN-RICE-20' }, { id:id(), name:'איקורא', supplier:'מדג סי פרוט', unit:'קופסא', sku:'IKR-125' }, { id:id(), name:'קרים צ׳יז', supplier:'קרים צ׳יז', unit:'בלוק', sku:'CRM-2KG' } ]; const db = store.all(); db.suppliers = mergeByName(db.suppliers, demoSuppliers); db.products = mergeByName(db.products, demoProducts); store.save(db); render(); pulse($('#stat-suppliers')); pulse($('#stat-products')); }); // Add supplier $('#add-supplier')?.addEventListener('click', async () => { const name = prompt('שם ספק'); if(!name) return; const phone = prompt('טלפון ספק') || ''; store.addSupplier({ id:id(), name, phone, items:[] }); render(); }); // Add product $('#add-product')?.addEventListener('click', async () => { const name = prompt('שם מוצר'); if(!name) return; const sup = prompt('שם ספק'); const unit = prompt('יחידה למשל אריזה, קופסא, קילו') || ''; const sku = prompt('SKU או מק״ט') || ''; store.addProduct({ id:id(), name, supplier:sup||'', unit, sku }); render(); }); $('#export-json')?.addEventListener('click', () => { const data = store.all(); download('orderroom_export.json', JSON.stringify(data, null, 2)); }); $('#export-csv')?.addEventListener('click', () => { const data = store.all(); const supRows = data.suppliers.map(s => `supplier,${csv(s.name)},${csv(s.phone)},${csv((s.items||[]).join('|'))}`); const prodRows = data.products.map(p => `product,${csv(p.name)},${csv(p.supplier)},${csv(p.unit)},${csv(p.sku)}`); const body = ['type,col1,col2,col3,col4', ...supRows, ...prodRows].join('\n'); download('orderroom_export.csv', body); }); $('#clear-suppliers')?.addEventListener('click', () => { if(confirm('למחוק את כל הספקים?')){ store.clearSuppliers(); render(); } }); $('#clear-products')?.addEventListener('click', () => { if(confirm('למחוק את כל המוצרים?')){ store.clearProducts(); render(); } }); $('#supplier-search')?.addEventListener('input', render); $('#product-search')?.addEventListener('input', render); function render(){ const db = store.all(); const supList = $('#supplier-list'); const prodList = $('#product-list'); // Stats $('#stat-suppliers').textContent = db.suppliers.length; $('#stat-products').textContent = db.products.length; // Suppliers const q1 = ($('#supplier-search')?.value||'').trim(); const sups = filterByName(db.suppliers, q1); if(sups.length === 0){ supList.innerHTML = `<p class="muted">אין ספקים תואמים</p>`; }else{ supList.innerHTML = sups.map(s => cardSupplier(s)).join(''); // wire actions $$('.supplier-edit', supList).forEach(btn => btn.addEventListener('click', onEditSupplier)); $$('.supplier-add-item', supList).forEach(btn => btn.addEventListener('click', onAddItem)); $$('.supplier-remove', supList).forEach(btn => btn.addEventListener('click', onRemoveSupplier)); } // Products const q2 = ($('#product-search')?.value||'').trim(); const prods = filterByName(db.products, q2); if(prods.length === 0){ prodList.innerHTML = `<p class="muted">אין מוצרים תואמים</p>`; }else{ prodList.innerHTML = prods.map(p => cardProduct(p)).join(''); $$('.product-remove', prodList).forEach(btn => btn.addEventListener('click', onRemoveProduct)); } } function onEditSupplier(e){ const idv = e.currentTarget.getAttribute('data-id'); const db = store.all(); const s = db.suppliers.find(x => x.id === idv); if(!s) return; const name = prompt('שם ספק', s.name); if(!name) return; const phone = prompt('טלפון ספק', s.phone||'') || ''; s.name = name; s.phone = phone; store.save(db); render(); } function onAddItem(e){ const idv = e.currentTarget.getAttribute('data-id'); const db = store.all(); const s = db.suppliers.find(x => x.id === idv); if(!s) return; const item = prompt('פריט חדש לספק'); if(!item) return; s.items = s.items || []; s.items.push(item); store.save(db); render(); } function onRemoveSupplier(e){ const idv = e.currentTarget.getAttribute('data-id'); const db = store.all(); db.suppliers = db.suppliers.filter(x => x.id !== idv); store.save(db); render(); } function onRemoveProduct(e){ const idv = e.currentTarget.getAttribute('data-id'); const db = store.all(); db.products = db.products.filter(x => x.id !== idv); store.save(db); render(); } function filterByName(list, q){ if(!q) return list; const t = q.toLowerCase(); return list.filter(x => (x.name||'').toLowerCase().includes(t)); } function cardSupplier(s){ const items = (s.items||[]).slice(0,4).join(' • '); return `<article class="card"> <div class="row gap" style="justify-content:space-between"> <h3>${escapeHtml(s.name)}</h3> <div class="row gap"> <button class="btn btn-ghost supplier-edit" data-id="${s.id}">ערוך</button> <button class="btn btn-ghost supplier-remove" data-id="${s.id}">מחק</button> </div> </div> <p class="muted">${items || 'אין פריטים עדיין'}</p> <div class="row gap"> <button class="btn btn-outline supplier-add-item" data-id="${s.id}">הוסף פריט</button> ${s.phone ? `<a class="btn btn-primary" href="tel:${s.phone}">התקשר</a>` : ''} </div> </article>`; } function cardProduct(p){ return `<article class="card"> <div class="row gap" style="justify-content:space-between"> <h3>${escapeHtml(p.name)}</h3> <button class="btn btn-ghost product-remove" data-id="${p.id}">מחק</button> </div> <p class="muted"> ספק: ${escapeHtml(p.supplier || 'לא משויך')} • יחידה: ${escapeHtml(p.unit || 'לא צוין')} • SKU: ${escapeHtml(p.sku || '-') } </p> </article>`; } function escapeHtml(str){ return String(str||'').replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[s])); } function id(){ return Math.random().toString(36).slice(2, 10) + Date.now().toString(36).slice(4); } function pulse(el){ if(!el) return; el.animate([{transform:'scale(1)'},{transform:'scale(1.06)'},{transform:'scale(1)'}],{duration:400, easing:'ease-out'}); } function csv(v){ return '"' + String(v||'').replace(/"/g,'""') + '"'; } function download(filename, content){ const blob = new Blob([content], {type:'text/plain;charset=utf-8'}); const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = filename; document.body.appendChild(a); a.click(); setTimeout(()=>{ URL.revokeObjectURL(a.href); a.remove(); }, 0); } function mergeByName(existing, incoming){ const map = new Map(existing.map(x => [x.name, x])); incoming.forEach(n => { if(!map.has(n.name)) existing.push(n); }); return existing; } // Initial render render(); })();
